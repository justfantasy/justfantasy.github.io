<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    <link rel="canonical" href="http://justfantasy.cn/2018/10/10/miniapp-beauty-girl/">
    
    
    <title>微信小程序练手 - 清纯可爱唯美小清新校花图集 | 美好时光小站 | 不悔梦归处，只恨太匆匆。</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="php,laravel,微信小程序">
    <meta name="description" content="小程序预览                                                                                             清纯可爱唯美小清新校花图集">
<meta property="og:type" content="article">
<meta property="og:title" content="微信小程序练手 - 清纯可爱唯美小清新校花图集">
<meta property="og:url" content="http://justfantasy.cn/2018/10/10/miniapp-beauty-girl/index.html">
<meta property="og:site_name" content="美好时光小站">
<meta property="og:description" content="小程序预览                                                                                             清纯可爱唯美小清新校花图集">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://justfantasy.cn/images/mm-miniapp.jpg">
<meta property="article:published_time" content="2018-10-10T11:04:00.000Z">
<meta property="article:modified_time" content="2019-01-09T01:42:07.683Z">
<meta property="article:author" content="JustFantasy">
<meta property="article:tag" content="php">
<meta property="article:tag" content="laravel">
<meta property="article:tag" content="微信小程序">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://justfantasy.cn/images/mm-miniapp.jpg">
    
        <link rel="alternate" type="application/atom+xml" title="美好时光小站" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">JustFantasy</h5>
          <a href="mailto:27506954@qq.com" title="27506954@qq.com" class="mail">27506954@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                分类
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/justfantasy" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/custom"  >
                <i class="icon icon-lg icon-link"></i>
                测试
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">微信小程序练手 - 清纯可爱唯美小清新校花图集</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">微信小程序练手 - 清纯可爱唯美小清新校花图集</h1>
        <h5 class="subtitle">
            
                <time datetime="2018-10-10T11:04:00.000Z" itemprop="datePublished" class="page-time">
  2018-10-10
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E7%BC%96%E7%A8%8B/">编程</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#小程序预览"><span class="post-toc-number">1.</span> <span class="post-toc-text">小程序预览</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#目的"><span class="post-toc-number">2.</span> <span class="post-toc-text">目的</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#小程序代码"><span class="post-toc-number">3.</span> <span class="post-toc-text">小程序代码</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#数据结构"><span class="post-toc-number">4.</span> <span class="post-toc-text">数据结构</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#后端接口"><span class="post-toc-number">5.</span> <span class="post-toc-text">后端接口</span></a></li></ol>
        </nav>
    </aside>


<article id="post-miniapp-beauty-girl"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">微信小程序练手 - 清纯可爱唯美小清新校花图集</h1>
        <div class="post-meta">
            <time class="post-time" title="2018-10-10 19:04:00" datetime="2018-10-10T11:04:00.000Z"  itemprop="datePublished">2018-10-10</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E7%BC%96%E7%A8%8B/">编程</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h3 id="小程序预览"><a href="#小程序预览" class="headerlink" title="小程序预览"></a>小程序预览</h3><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/images/mm-miniapp.jpg" alt="清纯可爱唯美小清新校花图集" title="">
                </div>
                <div class="image-caption">清纯可爱唯美小清新校花图集</div>
            </figure>
<a id="more"></a>
<h3 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h3><p>现在小程序这么火，我也想蹭蹭热度，功能其实很简单。就是单纯的图片展示而已。图片也是来源于互联网。<br>虽说已经上线两个多月了，不过用户很少，看了一下统计，不到100。<br>之前小程序名称中带了美女两个字，所以在微信端是搜不到的。<br>后面问了腾讯的客服，她也只是委婉的说我的名称中带了被举报的词语。所以才搜不到。<br>我自己又去微信上测试了一下，发现就是美女这个词语导致的。<br>小程序名称带了一堆关键词，就是尝试一下看会不会被更多的人搜到。<br>反正现在的结果来看，没什么鸟用。</p>
<h3 id="小程序代码"><a href="#小程序代码" class="headerlink" title="小程序代码"></a>小程序代码</h3><p>小程序的代码已开源，很简单，没什么复杂的逻辑，就是单纯的页面展示。<br>戳这里：<a href="https://github.com/justfantasy/beauty-girl.git" target="_blank" rel="noopener">https://github.com/justfantasy/beauty-girl.git</a></p>
<h3 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- 就两个表，够简单</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`beauty_albums`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`src`</span> <span class="built_in">varchar</span>(<span class="number">30</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span> <span class="keyword">COMMENT</span> <span class="string">'来源网站'</span>,</span><br><span class="line">  <span class="string">`original_id`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span> <span class="keyword">COMMENT</span> <span class="string">'原始ID'</span>,</span><br><span class="line">  <span class="string">`classify`</span> <span class="built_in">varchar</span>(<span class="number">30</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span> <span class="keyword">COMMENT</span> <span class="string">'分类'</span>,</span><br><span class="line">  <span class="string">`title`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span> <span class="keyword">COMMENT</span> <span class="string">'标题'</span>,</span><br><span class="line">  <span class="string">`cover`</span> <span class="built_in">varchar</span>(<span class="number">500</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span> <span class="keyword">COMMENT</span> <span class="string">'封面'</span>,</span><br><span class="line">  <span class="string">`num`</span> <span class="built_in">tinyint</span>(<span class="number">4</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span> <span class="keyword">COMMENT</span> <span class="string">'数量'</span>,</span><br><span class="line">  <span class="string">`publish_at`</span> <span class="built_in">timestamp</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`created_at`</span> <span class="built_in">timestamp</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`updated_at`</span> <span class="built_in">timestamp</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line">  <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`beauty_lists_src`</span> (<span class="string">`src`</span>,<span class="string">`original_id`</span>) <span class="keyword">USING</span> BTREE,</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`beauty_lists_publish_at`</span> (<span class="string">`publish_at`</span>) <span class="keyword">USING</span> BTREE</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">7068</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4 <span class="keyword">COMMENT</span>=<span class="string">'美女专辑'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`beauty_images`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`aid`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span> <span class="keyword">COMMENT</span> <span class="string">'列表ID'</span>,</span><br><span class="line">  <span class="string">`url`</span> <span class="built_in">varchar</span>(<span class="number">500</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span> <span class="keyword">COMMENT</span> <span class="string">'图片地址'</span>,</span><br><span class="line">  <span class="string">`created_at`</span> <span class="built_in">timestamp</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`updated_at`</span> <span class="built_in">timestamp</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`beauty_images_aid`</span> (<span class="string">`aid`</span>) <span class="keyword">USING</span> BTREE</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">120953</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4 <span class="keyword">COMMENT</span>=<span class="string">'美女图片'</span>;</span><br></pre></td></tr></table></figure>
<h3 id="后端接口"><a href="#后端接口" class="headerlink" title="后端接口"></a>后端接口</h3><p>是用laravel5.6写的，也很简单，这里贴一些主要的代码吧</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//采集用的querylist的一个包，定时任务，每天采集一次</span></span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">collectFromMmonly</span><span class="params">($page=<span class="number">1</span>, $url=<span class="string">'http://www.mmonly.cc/mmtp/'</span>, $today=false)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ($page &gt; <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        $url .= <span class="string">'list_9_'</span> . $page . <span class="string">'.html'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        $query = <span class="keyword">new</span> QueryList();</span><br><span class="line">        $query = $query-&gt;get($url, [], [</span><br><span class="line">                <span class="string">'headers'</span> =&gt; [</span><br><span class="line">                    <span class="string">'Proxy-Connection'</span> =&gt; <span class="string">'keep-alive'</span>,</span><br><span class="line">                    <span class="string">'Pragma'</span> =&gt; <span class="string">'no-cache'</span>,</span><br><span class="line">                    <span class="string">'Cache-Control'</span> =&gt; <span class="string">'no-cache'</span>,</span><br><span class="line">                    <span class="string">'Accept'</span> =&gt; <span class="string">'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8'</span>,</span><br><span class="line">                    <span class="string">'User-Agent'</span> =&gt; <span class="string">'Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.116 Safari/537.36'</span></span><br><span class="line">                ]</span><br><span class="line">        ])-&gt;encoding(<span class="string">'UTF-8'</span>,<span class="string">'GB2312'</span>)-&gt;removeHead();</span><br><span class="line">        $data = $query-&gt;rules([</span><br><span class="line">                <span class="string">'url'</span> =&gt; [<span class="string">'.ABox&gt;a'</span>, <span class="string">'href'</span>],</span><br><span class="line">                <span class="string">'title'</span> =&gt; [<span class="string">'img'</span>, <span class="string">'alt'</span>],</span><br><span class="line">                <span class="string">'cover'</span> =&gt; [<span class="string">'img'</span>, <span class="string">'src'</span>],</span><br><span class="line">                <span class="string">'other'</span> =&gt; [<span class="string">'.items_likes'</span>, <span class="string">'text'</span>],</span><br><span class="line">        ])-&gt;range(<span class="string">'.item_list .item'</span>)-&gt;query()-&gt;getData()-&gt;all();</span><br><span class="line"></span><br><span class="line">        $dataCount = count($data);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> ($data <span class="keyword">as</span> $k =&gt; $d)</span><br><span class="line">        &#123;</span><br><span class="line">            $tmp = explode(<span class="string">'/'</span>, $d[<span class="string">'url'</span>]);</span><br><span class="line">            $tmpCount = count($tmp);</span><br><span class="line">            $now = date(<span class="string">'Y-m-d H:i:s'</span>);</span><br><span class="line">            $other = explode(<span class="string">"共"</span>, $d[<span class="string">'other'</span>]);</span><br><span class="line">            $insert = [</span><br><span class="line">                <span class="string">'src'</span> =&gt; <span class="string">'mmonly'</span>,</span><br><span class="line">                <span class="string">'original_id'</span> =&gt; explode(<span class="string">'.'</span>, $tmp[$tmpCount<span class="number">-1</span>])[<span class="number">0</span>],</span><br><span class="line">                <span class="string">'classify'</span> =&gt; $tmp[$tmpCount<span class="number">-2</span>],</span><br><span class="line">                <span class="string">'title'</span> =&gt; $d[<span class="string">'title'</span>],</span><br><span class="line">                <span class="string">'cover'</span> =&gt; $d[<span class="string">'cover'</span>],</span><br><span class="line">                <span class="string">'publish_at'</span> =&gt; !$today ? str_replace(<span class="string">'&amp;nbsp;'</span>, <span class="string">''</span>, htmlentities(trim($other[<span class="number">0</span>], <span class="string">'DATE:'</span>))) : date(<span class="string">'Y-m-d H:i:s'</span>),</span><br><span class="line">                <span class="string">'num'</span> =&gt; count($other) &gt; <span class="number">1</span> ? trim($other[<span class="number">1</span>], <span class="string">'共张'</span>) : <span class="number">0</span>,</span><br><span class="line">                <span class="string">'created_at'</span> =&gt; $now,</span><br><span class="line">                <span class="string">'updated_at'</span> =&gt; $now</span><br><span class="line">            ];</span><br><span class="line"></span><br><span class="line">            <span class="comment">//如果数据库已经存在，则直接退出</span></span><br><span class="line">            $count = BeautyAlbums::query()-&gt;where(<span class="string">'src'</span>, <span class="string">'mmonly'</span>)-&gt;where(<span class="string">'original_id'</span>, $insert[<span class="string">'original_id'</span>])-&gt;count();</span><br><span class="line">            <span class="keyword">if</span> ($count)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> ($k &gt;= $dataCount - <span class="number">1</span>)</span><br><span class="line">                    <span class="keyword">exit</span>(<span class="string">'没有最新的数据需要采集！'</span>);</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                $id = DB::table(<span class="string">'beauty_albums'</span>)-&gt;insertGetId($insert);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//获取图片</span></span><br><span class="line">                <span class="keyword">$this</span>-&gt;collectImageFromMmonly($d[<span class="string">'url'</span>], $insert[<span class="string">'original_id'</span>], $insert[<span class="string">'num'</span>], $id, $now, $today);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (\Illuminate\Database\QueryException $e)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (\GuzzleHttp\<span class="keyword">Exception</span>\ClientException $e)</span><br><span class="line">    &#123;</span><br><span class="line">        error_log(<span class="string">'page:'</span> . $page . PHP_EOL, <span class="number">3</span>, <span class="string">'p.log'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接口更简单…一目了然，注释都省了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>\<span class="title">Api</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">BeautyAlbums</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">BeautyImages</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BeautyController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">(Request $request)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//详情页的推荐列表</span></span><br><span class="line">        <span class="keyword">if</span> ($request-&gt;type == <span class="string">'recommend'</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            $pageSize = <span class="number">20</span>;</span><br><span class="line">            $count = BeautyAlbums::query()-&gt;where(<span class="string">'classify'</span>, $request-&gt;classify)-&gt;count();</span><br><span class="line">            $totalPage = floor($count/$pageSize);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//从同一分类中随机取一页，作为推荐的内容</span></span><br><span class="line">            $page = mt_rand(<span class="number">1</span>, $totalPage &gt; <span class="number">1</span> ? $totalPage : <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">return</span> BeautyAlbums::query()-&gt;orderBy(<span class="string">'publish_at'</span>, <span class="string">'desc'</span>)</span><br><span class="line">                    -&gt;orderBy(<span class="string">'id'</span>, <span class="string">'desc'</span>)</span><br><span class="line">                    -&gt;select(<span class="string">'id'</span>, <span class="string">'title'</span>, <span class="string">'cover'</span>)</span><br><span class="line">                    -&gt;skip(($page<span class="number">-1</span>)*$totalPage)</span><br><span class="line">                    -&gt;take($pageSize)</span><br><span class="line">                    -&gt;where(<span class="string">'classify'</span>, $request-&gt;classify)</span><br><span class="line">                    -&gt;get();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $query = BeautyAlbums::query()-&gt;orderBy(<span class="string">'publish_at'</span>, <span class="string">'desc'</span>)</span><br><span class="line">                -&gt;orderBy(<span class="string">'id'</span>, <span class="string">'desc'</span>)</span><br><span class="line">                -&gt;select(<span class="string">'id'</span>, <span class="string">'title'</span>, <span class="string">'cover'</span>);</span><br><span class="line">        <span class="keyword">if</span> ($request-&gt;classify)</span><br><span class="line">        &#123;</span><br><span class="line">            $query-&gt;where(<span class="string">'classify'</span>, $request-&gt;classify);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $query-&gt;paginate(<span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">view</span><span class="params">($id)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $ret = BeautyAlbums::query()-&gt;select(<span class="string">'id'</span>, <span class="string">'title'</span>, <span class="string">'cover'</span>, <span class="string">'publish_at'</span>, <span class="string">'classify'</span>)-&gt;find($id);</span><br><span class="line">        $ret[<span class="string">'images'</span>] = BeautyImages::query()-&gt;where(<span class="string">'aid'</span>, $id)-&gt;select(<span class="string">'url'</span>)-&gt;get();</span><br><span class="line">        <span class="keyword">return</span> $ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2019-01-09T01:42:07.683Z" itemprop="dateUpdated">2019-01-09 09:42:07</time>
</span><br>


        
        这里可以写作者留言，标签和 hexo 中所有变量及辅助函数等均可调用，示例：<a href="/2018/10/10/miniapp-beauty-girl/" target="_blank" rel="external">http://justfantasy.cn/2018/10/10/miniapp-beauty-girl/</a>
        
    </div>
    
    <footer>
        <a href="http://justfantasy.cn">
            <img src="/img/avatar.png" alt="JustFantasy">
            JustFantasy
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/laravel/" rel="tag">laravel</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php/" rel="tag">php</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/" rel="tag">微信小程序</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://justfantasy.cn/2018/10/10/miniapp-beauty-girl/&title=《微信小程序练手 - 清纯可爱唯美小清新校花图集》 — 美好时光小站&pic=http://justfantasy.cn/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://justfantasy.cn/2018/10/10/miniapp-beauty-girl/&title=《微信小程序练手 - 清纯可爱唯美小清新校花图集》 — 美好时光小站&source=小程序预览
                
                    
                    
            ..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://justfantasy.cn/2018/10/10/miniapp-beauty-girl/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《微信小程序练手 - 清纯可爱唯美小清新校花图集》 — 美好时光小站&url=http://justfantasy.cn/2018/10/10/miniapp-beauty-girl/&via=http://justfantasy.cn" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://justfantasy.cn/2018/10/10/miniapp-beauty-girl/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2018/10/11/professional-javascript-for-web-developers-3rd/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">JavaScript高级程序设计（第3版）中文高清 PDF 百度网盘下载</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2018/10/10/HTML5+CSS3-development-actual-combat/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">HTML5+CSS3开发实战 PDF 百度网盘下载</h4>
      </a>
    </div>
  
</nav>



    

</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        你的支持是我最大的动力~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechatpay.png" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechatpay.png" data-alipay="/img/alipay.png">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>JustFantasy &copy; 2020</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://justfantasy.cn/2018/10/10/miniapp-beauty-girl/&title=《微信小程序练手 - 清纯可爱唯美小清新校花图集》 — 美好时光小站&pic=http://justfantasy.cn/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://justfantasy.cn/2018/10/10/miniapp-beauty-girl/&title=《微信小程序练手 - 清纯可爱唯美小清新校花图集》 — 美好时光小站&source=小程序预览
                
                    
                    
            ..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://justfantasy.cn/2018/10/10/miniapp-beauty-girl/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《微信小程序练手 - 清纯可爱唯美小清新校花图集》 — 美好时光小站&url=http://justfantasy.cn/2018/10/10/miniapp-beauty-girl/&via=http://justfantasy.cn" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://justfantasy.cn/2018/10/10/miniapp-beauty-girl/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACI0lEQVR42u3a0YrDMAwEwPz/T/deC+XSlZQUYk+eyjVNPD5YLMvHEV+vj+v97//d8/7t59POn3DccWFgYDyW8Tq9knt6yHyaognCwMDYgFGNxfPPydCr7/oyZgwMDIz4c7LUS4IVAwMDY86YVMxVHgYGBkavHE1ek2/G/bQWx8DAeCAjj8jff76lv4GBgfEoxn3b/b2WQHNUGBgYSzPygMsXZHkbYBK4GBgY+zDOQ3B+8Gs+x8kIMTAwMHqHJ6pB3GtnFgIXAwPj4YzecYp522AS6JedCsHAwHgUo7cpX21nVsM0GiEGBsYGjGTLvldeVheRzYNiGBgY2zB6G/fVxVw+ZYXSFwMDY2lGshysYqrLu2QioidjYGAszZgUtJPAjTb9q20JDAyM5Rj5sYl5G7JZoCZIDAyMpRm9IxS9w17nQ+81Ssv/EwwMjMcy8mi7rz2QtDmjIhYDA2NRRnWbLF/k5UOpLkAxMDD2ZORNyupBikmRXAhiDAyMzRh5gTopRHvHL6K9QwwMjM0YSeAmd/ZiunAPBgbGBoxk038eo9XmZeFXGBgYizJexSsPx0ns5pN15NmPgYHxWEZ+TZqXk0Xh/GkYGBhrMHqFaPXFk4MXyXsxMDB2YFSD73zhWD1M1mtCYGBgYFy1DZcXwAnsS0WOgYGBkcdfK7jzkL0gcDEwMB7IqB6tqAZuPtDe9h8GBsbajPxnV70+KVyrbVEMDIxFGX98ktsZX+ZWJQAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


lazyScripts.push('//s95.cnzz.com/z_stat.php?id=1279119026&web_id=1279119026')

</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '编程，读书，看电影。';
            clearTimeout(titleTime);
        } else {
            document.title = '美好时光小站';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
